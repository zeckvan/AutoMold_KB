# ğŸ“‘ AutoMold_Thread1 è‡ªå‹•æ’æ¨¡æ’ç”¢é‚è¼¯ä¸€ï¼ˆç´°éƒ¨è¦å‰‡ï¼‰

## 1. è³‡æ–™ä¾†æºèˆ‡ç¯©é¸æ¢ä»¶

-   **ä¾†æºè¡¨**ï¼š`AutoMold_ArticleMold`
-   **ç¯©é¸æ¢ä»¶**ï¼š
    -   `SumBodySizeNeed > 0`ï¼ˆå‹é«” Size æ¬ æ•¸å¤§æ–¼ 0ï¼‰
    -   `SteerRequiredUpperMoldQuantity âˆ’ ActualRequiredUpperMoldQuantity > 0`
-   **æ’åº**ï¼šä¾ `SortMold` ç”±å°åˆ°å¤§

------------------------------------------------------------------------

## 2. ç„¡è³‡æ–™æƒ…å¢ƒ

-   è‹¥ç„¡ç¬¦åˆæ¢ä»¶çš„ `AutoMold_ArticleMold`ï¼š
    -   æª¢æŸ¥
        `AutoMold_ProductionScheduleDay`ï¼ˆç”Ÿç”¢æ’ç­æ—¥è³‡è¨Šï¼‰æ˜¯å¦ä»æœ‰æœªè™•ç†è³‡æ–™
    -   è‹¥ **æœ‰** â†’ è®€å–ä¸‹ä¸€ç­†ç”Ÿç”¢æ’ç­æ—¥è³‡æ–™ â†’ é‡æ–°é€²å…¥æ’æ¨¡æ’ç”¢äº”é …é‚è¼¯
    -   è‹¥ **æ²’æœ‰** â†’ çµæŸæ•´é«”æ’æ¨¡æ’ç”¢é‚è¼¯

------------------------------------------------------------------------

## 3. æœ‰è³‡æ–™æƒ…å¢ƒï¼ˆé€ç­†è™•ç†ï¼‰

### 3.1 æ‰¾å°‹ã€å‰ç­æ©Ÿå°å­”ä½è³‡è¨Šã€‘

-   **ä¾†æºè¡¨**ï¼š`AutoMold_Produce`
-   **é€£çµæ¢ä»¶**ï¼š
    `MoldNo, ZZGENDER, ZZPARTNO, ProductSize` èˆ‡ `AutoMold_ArticleMold`
    å°æ‡‰ä¸€è‡´
-   **æ’åº**ï¼šä¾ `ResourceId` ç”±å°åˆ°å¤§
-   **è™•ç†é™åˆ¶ï¼š** å·²è™•ç†ç­†æ•¸ â‰¤ `AutoMold_ArticleMold.SteerRequiredUpperMoldQuantity`

------------------------------------------------------------------------

### 3.2 æª¢æŸ¥ã€å…±æ¨¡æƒ…å¢ƒã€‘

-   **ä¾†æºè¡¨**ï¼š`AutoMold_Temp`
-   **æ¢ä»¶**ï¼š
    ç›¸åŒ `ResourceId`ã€ç›¸åŒ `ProductId`ã€ä¸åŒ `MoldPcsSeq`ï¼Œä¸”åŒä¸€
    `ShiftName, ShiftDate, FacilityId`
-   **è™•ç†é‚è¼¯**ï¼š
    1.  æ–°å¢ä¸€ç­†ç´€éŒ„è‡³ `AutoMold_Temp`

    2.  æ›´æ–° `AutoMold_ArticleMold`ï¼š

        - æ¬„ä½ï¼š 
            -   `SumBodySizeNeed -= AutoMold_Temp.ShiftWorkQty`
            -   `ActualRequiredUpperMoldQuantity += 1`
        - æ¢ä»¶ï¼š
            -   `SortMold = AutoMold_ArticleMold.SortMold`   

    3.  æ›´æ–° `AutoMold_WorkMold`ï¼š

        - æ¬„ä½ï¼š   
            -   `MoldedQuantity += AutoMold_Temp.ShiftWorkQty`
            -   `UnmoldedQuantity = GAMNG âˆ’ MoldedQuantity`
        - æ¢ä»¶ï¼š
            -   AufnrSeq = 
            ``` sql
            SELECT TOP 1 AutoMold_WorkMold.AufnrSeq
            FROM AutoMold_WorkMold 
            WHERE AufnrSeq IN AutoMold_ArticleMold.SortOrderList 
            AND UnmoldedQuantity > 0 
            ORDER BY AufnrSeq ASC;
            ```  

    4.  è‹¥ `AutoMold_Temp.WorkQty - AutoMold_Temp.ShiftWorkQty > 0` â†’
        å˜—è©¦åˆ†æ´¾è‡³ã€ç›¸åŒæ¢ä»¶çš„å·¥å–®åºé›†åˆã€‘

------------------------------------------------------------------------

### 3.3 æ©Ÿå°é¤˜åŠ›åˆ†æ´¾ï¼ˆç›¸åŒæ¢ä»¶å·¥å–®ï¼‰

-   **ä¾†æºè¡¨**ï¼š`AutoMold_WorkMold`

-   **æ¢ä»¶**ï¼š

    -   `AufnrSeq âˆˆ AutoMold_ArticleMold.SortOrderList`
    -   `UnmoldedQuantity > 0`

-   **æ’åº**ï¼šä¾ `AufnrSeq` ç”±å°åˆ°å¤§

-   **SQL åƒè€ƒ**ï¼š

    ``` sql
    SELECT *
    FROM AutoMold_WorkMold 
    WHERE AufnrSeq IN AutoMold_ArticleMold.SortOrderList 
      AND UnmoldedQuantity > 0 
    ORDER BY AufnrSeq ASC;
    ```

-   **è™•ç†é‚è¼¯**ï¼š

    -   é€ç­†å¯«å…¥ `AutoMold_Temp`
    -   æ›´æ–° `AutoMold_ArticleMold`ï¼ˆåŒä¸Šè¦å‰‡ï¼‰
    -   æ›´æ–° `AutoMold_WorkMold`ï¼ˆåŒä¸Šè¦å‰‡ï¼‰
    -   æŒçºŒåˆ†æ´¾ç›´åˆ°
        `AutoMold_Temp.WorkQty - AutoMold_Temp.ShiftWorkQty = 0`ï¼ˆæˆ°åŠ›è€—ç›¡ï¼‰

------------------------------------------------------------------------

### 3.4 æ‰¾ä¸åˆ°ã€å‰ç­å­”ä½æ©Ÿå°ã€‘æƒ…å¢ƒ

-   **è‹¥ç„¡ `AutoMold_Produce` â†’ æª¢æŸ¥ å…±æ¨¡æ¨¡å…· (`BMolds`)**
-   **ä¾†æºè¡¨**ï¼š`AutoMold_ArticleMold, BMolds, AutoMold_Produce`
-   **æ¢ä»¶**ï¼š
    -   `AutoMold_ArticleMold.MoldNo = BMolds.MoldNo`
    -   `AutoMold_ArticleMold.ZZGENDER = BMolds.MoldNo`
    -   `AutoMold_ArticleMold.ZZPARTNO = BMolds.MoldNo`
    -   `AutoMold_ArticleMold.ProductSize = BMolds.MoldNo`
    -   `AutoMold_Produce.ProductId = BMolds.ProductId`
    -   `AutoMold_Produce.MoldPcsSeq <> BMolds.MoldPcsSeq`
-   **è™•ç†é‚è¼¯**ï¼šèˆ‡ **3.2** ç›¸åŒ
-   **é¡å¤–é™åˆ¶**ï¼š  
    è‹¥ `AutoMold_Produce.ProductId` å·²å­˜åœ¨æ–¼ `AutoMold_Temp.ProductId` ä¸”æƒ…å¢ƒ **éå…±æ¨¡** â†’ ä¸å¯æ’å…¥ï¼Œéœ€é‡æ–°æ‰¾å°‹ä¸‹ä¸€ç­†è³‡æ–™
-   **è‹¥ä»æ‰¾ä¸åˆ° â†’ é€²å…¥ã€Œ3.5 ç¢ºèªè©²æ©Ÿå°æœªè¢«æ’æ¨¡ã€**

------------------------------------------------------------------------

### 3.5 ç¢ºèªæ©Ÿå°æœªè¢«æ’æ¨¡

-   **ä¾†æºè¡¨**ï¼š`AutoMold_Temp`
-   **æ¢ä»¶**ï¼šåŒä¸€ `ResourceId, ShiftName, ShiftDate, FacilityId`
-   **è™•ç†é‚è¼¯**ï¼š
    -   è‹¥å·²æœ‰ç´€éŒ„ä¸”éå…±æ¨¡ â†’ æ›ä¸‹ä¸€ç­† `ResourceId`
    -   è‹¥ `å‰ç­å­”ä½æ©Ÿå°.ProductId` å·²å­˜åœ¨æ–¼ `AutoMold_Temp.ProductId` ä¸”æƒ…å¢ƒ **éå…±æ¨¡** â†’ è©²è³‡æ–™ä¸å¯æ’å…¥ï¼Œéœ€é‡æ–°æ‰¾å°‹ä¸‹ä¸€ç­†è³‡æ–™
    -   è‹¥æ²’æœ‰ç´€éŒ„ â†’  
        1.  æ–°å¢ä¸€ç­†ç´€éŒ„è‡³ `AutoMold_Temp`  
        2.  æ›´æ–° `AutoMold_ArticleMold`ï¼ˆåŒä¸Šè¦å‰‡ï¼‰  
        3.  æ›´æ–° `AutoMold_WorkMold`ï¼ˆåŒä¸Šè¦å‰‡ï¼‰
    -   è‹¥ `AutoMold_Temp.WorkQty - AutoMold_Temp.ShiftWorkQty > 0` â†’ å˜—è©¦åˆ†æ´¾è‡³ã€ç›¸åŒæ¢ä»¶å·¥å–®ã€‘

------------------------------------------------------------------------

## 4. æµç¨‹çµ‚æ­¢æ¢ä»¶

-   ç•¶ **å‹é«” Size æ¬ æ•¸** å·²å®Œå…¨è™•ç†ï¼Œæˆ–
    **æ‰€æœ‰æ©Ÿå°ç„¡æˆ°åŠ›å¯å†åˆ†æ´¾**ï¼Œå‰‡ï¼š
    -   è‹¥æœ‰ä¸‹ä¸€ç­† `AutoMold_ArticleMold` â†’ è¿”å› **æ­¥é©Ÿ 3**
    -   è‹¥ç„¡ â†’ è¿”å› **æ­¥é©Ÿ 2** åˆ¤æ–·æ˜¯å¦æ›ä¸‹ä¸€ç­†ç”Ÿç”¢æ’ç­æ—¥
    -   è‹¥ä¹Ÿç„¡ â†’ **çµæŸæ•´é«”é‚è¼¯**


------------------------------------------------------------------------

## åé¡å¸³æœ¬æµç¨‹ï¼ˆCap-Ledgerï¼‰

1. åˆå§‹åŒ– Cap-Ledgerï¼ˆæ ¹æ“š ArticleMoldï¼‰ã€‚  
2. å»ºç«‹å€™é¸é›†ï¼ˆéœ€æ»¿è¶³ SumBodySizeNeed > 0 ä¸” SteerCap - Used > 0ï¼‰ã€‚  
3. é€ç­†åˆ†æ´¾ï¼š  
   - è‹¥ Used + 1 > SteerCap â†’ ä¸Ÿæ£„å€™é¸  
   - å¦å‰‡ï¼šè¼¸å‡ºä¸€åˆ—ï¼Œ`IsNewUpperMold`=1ï¼ŒUsed += 1  
   - å›åˆ°æ­¥é©Ÿ 2  
4. ç„¡å€™é¸æˆ–çš†é”ä¸Šé™ â†’ çµæŸã€‚  
5. è¼¸å‡ºå‰å¿…è·‘ Pre-Export Audit â†’ åˆªé™¤å°¾ç­†ç›´åˆ°ç¬¦åˆ capã€‚
